<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>着順掲示板を作る | 【Python】Tkinterで競馬の着順掲示板を作る</title>
    <link rel="stylesheet" type="text/css" href="css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="css/webstyle.css" />
    <link rel="next" title="あとがき" href="99-postface.html">
    <link rel="prev" title="設定画面を完成させる" href="03-configwindow.html">
    <meta name="generator" content="Re:VIEW Starter">
  </head>
  <body>
    <div class="page-outer">
      <nav class="side-content">
                <div class="rebuild">
          <a href="javascript:void(0)" onclick="rebuildAndReloadForcedly()">Rebuild and Reload</a>
        </div>
                <a class="nav-title" href="index.html">【Python】Tkinterで競馬の着順掲示板を作る</a>
<ul class="toc toc-1">
    <li class="toc-chapter"><a href="./00-preface.html">まえがき</a></li>
    <li class="toc-chapter"><a href="./01-install.html">1 インストール</a></li>
    <li class="toc-chapter"><a href="./02-tuto.html">2 チュートリアル</a></li>
    <li class="toc-chapter"><a href="./03-configwindow.html">3 設定画面を完成させる</a></li>
    <li class="toc-chapter"><a href="./04-makeboard.html">4 着順掲示板を作る</a>
      <ul class="toc toc-2">
        <li class="toc-section"><a href="#h4-1">4.1 掲示板用のウィンドウを作る</a></li>
        <li class="toc-section"><a href="#h4-2">4.2 ラベルを配置する</a></li>
        <li class="toc-section"><a href="#h4-3">4.3 図形を作成する</a></li>
        <li class="toc-section"><a href="#h4-4">4.4 同着の処理を作る</a></li>
      </ul>
    </li>
    <li class="toc-chapter"><a href="./99-postface.html">あとがき</a></li>
</ul>
      </nav>
      <div class="page-inner">
        <header class="page-header">
        </header>
        <main class="page-main">
<h1 class="boldlines center twolines"><a id="h4"></a><span class="secno">第4章</span> <br/>着順掲示板を作る</h1>
<div class="abstract">
<p>いよいよ着順掲示板の再現に入ります。サブウィンドウの作成、ラベルの内容の変更、図形の描画と編集、place()とpack()によるウィジェットの配置について学んでいきます。</p>
</div>

<h2 id="makenewwindow" class="leftline"><a id="h4-1"></a><span class="secno">4.1</span> 掲示板用のウィンドウを作る</h2>
<p>ここまではひたすら設定画面を作ってきましたが、本章からは本題である掲示板の作成に入ります。</p>
<p>はじめに、掲示板のためのウィンドウを作成します。前章で作成した<code class="inline-code">createwindow</code>関数に追記していく形で掲示板のGUIを作っていきます。</p>
<div id="newwindow" class="caption-code">
<span class="caption">リスト4.1: リスト4.1: 掲示板用のウィンドウを作る</span>
<pre class="list">import tkinter as tk
from tkinter import ttk
import sys

def createwindow(): <span class="balloon">← 掲示板を作り変える関数</span>
    <del>pass</del>
    <b>board = tk.Toplevel()</b>
    <b>board.geometry('500x850')</b>
    <b>board.resizable(False, False)</b>
    <b>board.title('掲示板')</b>
    <b>board.configure(bg='black')</b>
</pre>
</div>
<p>既存のウィンドウからサブのウィンドウを呼び出すには、<code class="inline-code">tk.Toplevel()</code>を使用します。設定画面のcreateボタンを押して掲示板ウィンドウを生成した後、あえて右上の×ボタンを押してプログラムを終了してみてください。<code class="inline-code">tk.Tk()</code>で二つ目のウィンドウを呼び出した場合、そのウィンドウは残ってしまいますが、<code class="inline-code">tk.Toplevel()</code>を使用すればメインのウィンドウを消すとサブのウィンドウも消えてくれます。</p>
<p><code class="inline-code">geometry</code>,<code class="inline-code">resizable</code>,<code class="inline-code">title</code>に関しては、「<a href="02-tuto.html#h2-2">2.2 ウィンドウの作成</a>」で紹介した内容と同様です。その後、<code class="inline-code">configure()</code>に<code class="inline-code">bg</code>を指定し、背景色を黒にしています。<code class="inline-code">bg</code>には色の名前もしくはカラーコードが指定可能です。色の指定方法に関してはこの後に登場するものも同様です。</p>
<p>しかし、このコードには問題があります。お気づきだとは思いますが、この状態でcreateボタンを連打すると、その分だけサブウィンドウを生成できてしまいます。これを防ぐために、コードを<span class="listref"><a href="./04-makeboard.html#limitwindow">リスト4.2</a></span>のように書き換えましょう。</p>
<div id="limitwindow" class="caption-code">
<span class="caption">リスト4.2: リスト4.2: サブウィンドウの生成を制限する</span>
<pre class="list">def createwindow(): <span class="balloon">← 掲示板を作り変える関数</span>
    <b>global board</b>
    <b>if (board == None or not board.winfo_exists()):</b> <span class="balloon">← ウィンドウがない場合</span>
    <span class="indentbar"> </span>   board = tk.Toplevel() <span class="balloon">← 掲示板ウィンドウの定義</span>
    <span class="indentbar"> </span>   board.geometry('500x850')
    <span class="indentbar"> </span>   board.resizable(False, False)
    <span class="indentbar"> </span>   board.title('掲示板')
    <span class="indentbar"> </span>   board.configure(bg='black')
    <b>else:</b> <span class="balloon">← ウィンドウがある場合</span>
    <span class="indentbar"> </span>   <b>board.destroy()</b> <span class="balloon">← ウィンドウを破棄して作り直す</span>
    <span class="indentbar"> </span>   <b>createwindow()</b>

<b>board = None</b> <span class="balloon">← サブウィンドウを先に定義する</span>
</pre>
</div>
<p>サブウィンドウの生成を制限するために、<code class="inline-code">winfo_exists()</code>を使用しています。この関数は、ウィンドウが存在すれば<code class="inline-code">True</code>を、存在しなければ<code class="inline-code">False</code>を返します。返り値を<code class="inline-code">not</code>で反転させることによって、ウィンドウが存在しない時だけ<code class="inline-code">tk.Topleve()</code>を呼び出しています。</p>
<p>ウィンドウが存在するときは、のちに作成する図形の処理の関係でウィンドウを破棄して作り直すようにしています。</p>
<p>しかし、この関数はサブウィンドウが存在しているときしか利用できません。そのため、あらかじめ<code class="inline-code">createwindow()</code>の外で<code class="inline-code">board</code>を<code class="inline-code">None</code>(=空っぽの状態)として定義しておき、中のif文の条件に<code class="inline-code">None</code>を追加しています。この場合、<code class="inline-code">board</code>は<code class="inline-code">createwindow()</code>関数の外で宣言された変数になるので、関数の初めに<code class="inline-code">global board</code>と記述することで関数の中でも同じ変数を利用できるようにしています。</p>
<p>この状態でプログラムを実行し、createボタンを連打してみてください。サブウィンドウが一つしか生成されないことが確認できるはずです。</p>

<h2 id="placelabel" class="leftline"><a id="h4-2"></a><span class="secno">4.2</span> ラベルを配置する</h2>

<h3 class="none"><a id="h4-2-1"></a><span class="secno">4.2.1</span> 下準備</h3>
<p>ついに掲示板の見た目の制作に入ります。掲示板の本体は「<a href="02-tuto.html#h2-3">2.3 ラベルの配置</a>」で紹介した<code class="inline-code">Label</code>にオプションを付け加える形で作っていきます。これから追加していくコードのうちの一行を例として<span class="listref"><a href="./04-makeboard.html#codeexample">リスト4.3</a></span>に示します。</p>
<div id="codeexample" class="caption-code">
<span class="caption">リスト4.3: リスト4.3: これから追加するコードの例</span>
<pre class="list">shiba_b = tk.Label(board, text='芝', font=(&quot;MSゴシック&quot;, &quot;33&quot;, &quot;bold&quot;), width=2, foreground='white', bg='black')
</pre>
</div>
<p><code class="inline-code">font</code>は名前の通りラベルのフォントを指定します。本当は掲示板のフォントも再現したいのですが、非常に大がかりとなってしまうのでMSゴシックの太字で代用します。<code class="inline-code">foreground</code>は文字の色、<code class="inline-code">bg</code>はラベルの背景色です。</p>
<p>さて、このような設定を何度も書くことになるのですが、毎回<code class="inline-code">font=(&quot;MSゴシック&quot;, &quot;33&quot;, &quot;bold&quot;)</code>と書くのは大変ですね。また、このプログラムのフォントはMSゴシックの太字固定で、サイズのみを変更していきます。ということで、<code class="inline-code">(&quot;MSゴシック&quot;, &quot;任意のサイズ&quot;, &quot;bold&quot;)</code>を返す関数を作ってしまいましょう。</p>
<div id="fonteasy" class="caption-code">
<span class="caption">リスト4.4: リスト4.4: フォント指定を簡略化する関数</span>
<pre class="list">import tkinter as tk
from tkinter import ttk
import sys

#ラベルのフォントのテンプレート
<b>def font(size):</b>
<b>    return (&quot;MSゴシック&quot;, str(size), &quot;bold&quot;)</b>
</pre>
</div>
<p>これで、<span class="listref"><a href="./04-makeboard.html#codeexample">リスト4.3</a></span>のコードを、<span class="listref"><a href="./04-makeboard.html#codekairyo">リスト4.5</a></span>のように簡略化することができました。</p>
<div id="codekairyo" class="caption-code">
<span class="caption">リスト4.5: リスト4.5: 自作したfont()を利用したフォント指定</span>
<pre class="list">shiba_b = tk.Label(board, text='芝', font=font(33), width=2, foreground='white', bg='black')
</pre>
</div>

<h3 class="none"><a id="h4-2-2"></a><span class="secno">4.2.2</span> ラベルの宣言</h3>
<p>前置きが長くなりましたが、ここからはラベルの宣言・配置に入ります。一気にコードを追加していきますので、必要に応じてコピー＆ペーストを活用してください。</p>
<div id="makelabel" class="caption-code">
<span class="caption">リスト4.6: リスト4.6: ラベルの宣言</span>
<pre class="list">#掲示板を作り変える関数
def createwindow():
    global board
    if (board == None or not board.winfo_exists()):
    <span class="indentbar"> </span>   board = tk.Toplevel()
    <span class="indentbar"> </span>   board.geometry('500x850')
    <span class="indentbar"> </span>   board.resizable(False, False)
    <span class="indentbar"> </span>   board.title('掲示板')
    <span class="indentbar"> </span>   board.configure(bg='black')
    
    #ラベルの宣言
    #場名
    <b>course_b = tk.Label(board, text=&quot;\n&quot;.join(course.get()), font=font(33), foreground='white', bg='black')</b>
    
    #レース番号
    <b>race_no_b = tk.Label(board, text=race_no.get(), font=font(70), foreground='yellow', bg='black' )</b>
    <b>race_b = tk.Label(board, text='R', font=font(40), foreground='white', bg='black' )</b>

    #着順
    <b>first_b = tk.Label(board, text='Ⅰ', font=font(34), foreground='white', bg='blue')</b>
    <b>second_b = tk.Label(board, text='Ⅱ', font=font(34), foreground='white', bg='blue')</b>
    <b>third_b = tk.Label(board, text='Ⅲ', font=font(34), foreground='white', bg='blue')</b>
    <b>fourth_b = tk.Label(board, text='Ⅳ', font=font(34), foreground='white', bg='blue')</b>
    <b>fifth_b = tk.Label(board, text='Ⅴ', font=font(34), foreground='white', bg='blue')</b>

    #馬番
    <b>first_h_b = tk.Label(board, text=first_h.get(), font=font(70), width=2, foreground='yellow', bg='#707070', anchor='e')</b>
    <b>second_h_b = tk.Label(board, text=second_h.get(), font=font(70), width=2, foreground='yellow', bg='#707070', anchor='e')</b>
    <b>third_h_b = tk.Label(board, text=third_h.get(), font=font(70), width=2, foreground='yellow', bg='#707070', anchor='e')</b>
    <b>fourth_h_b = tk.Label(board, text=fourth_h.get(), font=font(70), width=2, foreground='yellow', bg='#707070', anchor='e')</b>
    <b>fifth_h_b = tk.Label(board, text=fifth_h.get(), font=font(70), width=2, foreground='yellow', bg='#707070', anchor='e')</b>
    
    #着差
    <b>margin_12_b = tk.Label(board, text=margin_12.get(), font=font(40), width=4, foreground='yellow', bg='#707070')</b>
    <b>margin_23_b = tk.Label(board, text=margin_23.get(), font=font(40), width=4, foreground='yellow', bg='#707070')</b>
    <b>margin_34_b = tk.Label(board, text=margin_34.get(), font=font(40), width=4, foreground='yellow', bg='#707070')</b>
    <b>margin_45_b = tk.Label(board, text=margin_45.get(), font=font(40), width=4, foreground='yellow', bg='#707070')</b>
    
    #馬場状態
    <b>shiba_b = tk.Label(board, text='芝', font=font(33), width=2, foreground='white', bg='black')</b>
    <b>shiba_c_b = tk.Label(board, text=shiba_c.get(), font=font(60), width=3, foreground='yellow', bg='#707070')</b>
    <b>dirt_b = tk.Label(board, text='ダート', font=font(33), foreground='white', bg='black')</b>
    <b>dirt_c_b = tk.Label(board, text=dirt_c.get(), font=font(60), width=3, foreground='yellow', bg='#707070')</b>

    #確定状況
    <b>kakutei_b = tk.Label(board, text=' ', font=font(90), width=3, foreground='white', bg='#707070')</b>

    #レコード
    <b>record_b = tk.Label(board, text=' ', font=font(45), width=4, foreground='red', bg='#707070')</b>

    #入線タイム
    <b>time_b = tk.Label(board, text='タイム', font=font(27), foreground='white', bg='black')</b>
    <b>time_min_b = tk.Label(board, text=time_min.get(), font=font(45), width=1, foreground='yellow', bg='#707070')</b>
    <b>dot = tk.Label(board, text='.', font=font(30), width=1, foreground='white', bg='black')</b>
    <b>time_sec_b = tk.Label(board, text=time_sec.get(), font=font(45), width=2, foreground='yellow', bg='#707070')</b>
    <b>dot2 = tk.Label(board, text='.', font=font(30), width=1, foreground='white', bg='black')</b>
    <b>time_sec10_b = tk.Label(board, text=time_sec10.get(), font=font(45), width=1, foreground='yellow', bg='#707070')</b>
    
    #4ハロン
    <b>ff_b = tk.Label(board, text='４Ｆ', font=font(27), foreground='white', bg='black')</b>
    <b>ff_sec_b = tk.Label(board, text=ff_sec.get(), font=font(45), width=2, foreground='yellow', bg='#707070')</b>
    <b>dot3 = tk.Label(board, text='.', font=font(30),width=1, foreground='white', bg='black')</b>
    <b>ff_sec10_b = tk.Label(board, text=ff_sec10.get(), font=font(45), width=1, foreground='yellow', bg='#707070')</b>
    
    #3ハロン
    <b>tf_b = tk.Label(board, text='３Ｆ', font=font(27), foreground='white', bg='black')</b>
    <b>tf_sec_b = tk.Label(board, text=tf_sec.get(), font=font(45), width=2, foreground='yellow', bg='#707070')</b>
    <b>dot4 = tk.Label(board,text='.', font=font(30), width=1, foreground='white', bg='black')</b>
    <b>tf_sec10_b = tk.Label(board, text=tf_sec10.get(), font=font(45), width=1, foreground='yellow', bg='#707070')</b>
</pre>
</div>
<p>下準備の際に解説していないオプションについて解説していきます。<code class="inline-code">anchor</code>は、ラベルの文字列の寄せ方を指定します。着順掲示板の馬番は右寄せの配置なので、<code class="inline-code">e</code>を指定しています。他にも、<code class="inline-code">w</code>(左寄せ)、<code class="inline-code">n</code>(上寄せ)、<code class="inline-code">s</code>(下寄せ)などの寄せ方が用意されています。</p>
<p>一部のLabelにおいて、テキストに<code class="inline-code">get()</code>関数を指定しています。これは、Entryをはじめとした文字列を入力もしくは指定できるウィジェットの内容を取得する関数です。</p>
<p>4ハロン、3ハロンのラベルにおいて、4F、3Fが全角になっていますが、こちらは意図的に全角にしています。</p>

<h3 class="none"><a id="h4-2-3"></a><span class="secno">4.2.3</span> ラベルの配置</h3>
<p>それでは、宣言したラベルを配置していきます！こちらも記述量が多いですが、頑張って書いていきましょう。</p>
<div id="labelplace" class="caption-code">
<span class="caption">リスト4.7: リスト4.7: ラベルの配置</span>
<pre class="list">#掲示板を作り変える関数
def createwindow():
    ...(省略)...
    tf_sec10_b = tk.Label(board, text=tf_sec10.get(), font=font(45), width=1, foreground='yellow', bg='#707070')

    #ラベルの配置
    <b>course_b.place(x=20, y=10) #場名</b>
    
    <b>race_b.place(x=150, y=35) #R</b>
    
    <b>first_b.place(x=24, y=132) #着順</b>
    <b>second_b.place(x=24, y=222)</b>
    <b>third_b.place(x=24, y=312)</b>
    <b>fourth_b.place(x=24, y=402)</b>
    <b>fifth_b.place(x=24, y=492)</b>
    
    <b>first_h_b.place(x=100, y=125, height=72) #馬番</b>
    <b>second_h_b.place(x=100, y=215, height=72)</b>
    <b>third_h_b.place(x=100, y=305, height=72)</b>
    <b>fourth_h_b.place(x=100, y=395, height=72)</b>
    <b>fifth_h_b.place(x=100, y=485, height=72)</b>
    
    <b>margin_12_b.place(x=310, y=165, height=60) #着差</b>
    <b>margin_23_b.place(x=310, y=260, height=60)</b>
    <b>margin_34_b.place(x=310, y=355, height=60)</b>
    <b>margin_45_b.place(x=310, y=450, height=60)</b>
    
    <b>shiba_b.place(x=60, y=560) #馬場状態</b>
    <b>shiba_c_b.place(x=15, y=610, height=75)</b>
    <b>dirt_b.place(x=22, y=700)</b>
    <b>dirt_c_b.place(x=15, y=750, height=75)</b>
    
    <b>kakutei_b.place(x=250 , y=10, height=120) #確定状況</b>

    <b>record_b.place(x=290, y=550, height=55) #レコード</b>
    
    <b>time_b.place(x=170, y=645) #入線タイム</b>
    <b>time_min_b.place(x=283, y=630, height=55)</b>
    <b>dot.place(x=323, y=623, height=100)</b>
    <b>time_sec_b.place(x=350, y=630, height=55)</b>
    <b>dot2.place(x=425, y=623, height=100)</b>
    <b>time_sec10_b.place(x=452, y=630,height=55)</b>

    <b>ff_b.place(x=205, y=715) #4ハロン</b>
    <b>ff_sec_b.place(x=350, y=700, height=55)</b>
    <b>dot3.place(x=425, y=693, height=100)</b>
    <b>ff_sec10_b.place(x=452, y=700, height=55)</b>
    
    <b>tf_b.place(x=205, y=780) #3ハロン</b>
    <b>tf_sec_b.place(x=350, y=770, height=55)</b>
    <b>dot4.place(x=425, y=770, height=78)</b>
    <b>tf_sec10_b.place(x=452, y=770, height=55)</b>
</pre>
</div>
<p>ここで、新たなウィジェットの配置方法として<code class="inline-code">place()</code>が登場します。これは、ウィンドウ(配置先)の左上を原点として、座標を指定してウィジェットを配置する関数です。<code class="inline-code">x</code>でx座標、<code class="inline-code">y</code>でy座標を指定しています。<code class="inline-code">relx, rely</code>を使用すると相対指定による配置もできますが、今回はウィンドウの大きさの変更を禁止しているので、絶対指定で配置します。</p>
<p>一部のウィジェットは<code class="inline-code">height</code>で高さ(縦の幅)を指定しています。</p>
<p>ここで、いったんプログラムを実行し、設定画面のcreateボタンを押して掲示板の見た目を確認してみましょう。<span class="imgref"><a href="./04-makeboard.html#board1">図4.1</a></span>のように表示されていれば大丈夫です。一気に華やかになりましたね。</p>
<div id="board1" class="image">
<img src="images/04-makeboard/board1.png" alt="現時点での掲示板" class="img border" />
<p class="caption">
図4.1: 現時点での掲示板
</p>
</div>

<h3 class="none"><a id="h4-2-4"></a><span class="secno">4.2.4</span> テキスト部分を完成させる</h3>

<h4><a id="h4-2-4-1"></a>レース番号の見た目を変える</h4>
<p>見た目はほとんど完成しましたが、レース番号、確定状況、レコードの表示がまだ不十分なので仕上げていきます。はじめに、レース番号の見た目を完成させましょう。競馬場で使用されている掲示板は、レース番号を範囲いっぱいに表示しています。そのため、1~9レースまでと、10~12レースで、フォントのサイズを変えていきます。</p>
<div id="raceno" class="caption-code">
<span class="caption">リスト4.8: リスト4.8: レース番号の見た目</span>
<pre class="list">    #レース番号
    <del>race_no_b = tk.Label(board, text=race_no.get(), font=font(70), foreground='yellow', bg='black' )</del>
<b>   if (len(number := race_no.get()) == 2):</b>
<b>        race_no_b = tk.Label(board, text=number, font=font(50), width=2, foreground='yellow', bg='black' )</b>
<b>        race_no_b.place(x=65, y=23)</b>
<b>    else:</b>
<b>        race_no_b = tk.Label(board, text=number, font=font(70), width=2, foreground='yellow', bg='black' )</b>
<b>        race_no_b.place(x=65, y=8)</b>
<b>    race_b = tk.Label(board, text='R', font=font(40), foreground='white', bg='black' )</b>
</pre>
</div>
<p><code class="inline-code">len()</code>関数で条件分岐させ、フォントサイズを変更しています。また、ウィジェットを配置する位置も少し変更しています。</p>
<p>ここで見慣れない演算子<code class="inline-code">:=</code>が登場していますね。これはセイウチ演算子と呼ばれるもので、条件式内で変数への代入処理を可能にします。C言語ではファイルの読み書きで頻出の処理ですね。Pythonでそれを行うにはこのように特殊な演算子を使う必要があります。</p>
<p>プログラムを実行し、<span class="imgref"><a href="./04-makeboard.html#racemitame">図4.2</a></span>のように1~9レースまでと10~12レースでフォントのサイズが変わるか確かめましょう。スピンボックスの内容を変える度にcreateボタンを押す必要があることに注意してください。</p>
<div id="racemitame" class="image">
<img src="images/04-makeboard/racemitame.png" alt="レース番号の動作テスト" class="img border" />
<p class="caption">
図4.2: レース番号の動作テスト
</p>
</div>

<h4><a id="h4-2-4-2"></a>確定状況を完成させる</h4>
<p>掲示板の右上に表示される<strong>確定</strong>、<strong>審議</strong>の文字は、背景色も変化します。そのため先ほどの項ではあえて完成させず、ここで改めて完成させます。</p>
<div id="kakutei" class="caption-code">
<span class="caption">リスト4.9: リスト4.9: 確定状況の完成</span>
<pre class="list">    #確定状況
    <del>kakutei_b = tk.Label(board, text=' ', font=font(90), width=3, foreground='white', bg='#707070')</del>
    <b>if ((text := kakutei.get()) == '確定'):</b>
    <b>    kakutei_b = tk.Label(board, text=text, font=font(90), width=3, foreground='white', bg='red')</b>
    <b>elif (text == '審議'):</b>
    <b>    kakutei_b = tk.Label(board, text=text, font=font(90), width=3, foreground='white', bg='blue')</b>
    <b>else:</b>
    <b>    kakutei_b = tk.Label(board, text=' ', font=font(90), width=3, foreground='white', bg='#707070')</b>
</pre>
</div>
<p>プルダウンメニューで<strong>確定</strong>が選択された場合は背景を赤に、<strong>審議</strong>が選択された場合は背景を青に、何も選択されていないときは背景をグレーにしています。</p>
<p>こちらもプログラムを実行し、<span class="imgref"><a href="./04-makeboard.html#kakuteimitame">図4.3</a></span>のようにテキストと背景色が変更されるか確認しましょう。</p>
<div id="kakuteimitame" class="image">
<img src="images/04-makeboard/kakuteimitame.png" alt="確定状況の動作テスト" class="img border" />
<p class="caption">
図4.3: 確定状況の動作テスト
</p>
</div>

<h4><a id="h4-2-4-3"></a>レコードの表示を完成させる</h4>
<p>長かったこの節もこれで最後です。レコードの表示を完成させましょう。</p>
<div id="record" class="caption-code">
<span class="caption">リスト4.10: リスト4.10: レコード表示の完成</span>
<pre class="list">    #レコード
    <del>record_b = tk.Label(board, text=' ', font=font(45), width=4, foreground='red', bg='#707070')</del>
    <b>if var_record.get():</b>
    <span class="indentbar"> </span>   <b>record_b = tk.Label(board, text='ﾚｺｰﾄﾞ', font=font(45), width=4, foreground='red', bg='#707070')</b>
    <b>else:</b>
    <span class="indentbar"> </span>   <b>record_b = tk.Label(board, text='', font=font(45), width=4, foreground='red', bg='#707070')</b>
</pre>
</div>
<p>先ほどまでと同様に条件分岐でテキストの内容を変更しています。判定用の変数にはチェックボックスを作成するときに<code class="inline-code">variable</code>に指定したものを使います。「<a href="03-configwindow.html#h3-4">3.4 チェックボックス</a>」で解説したように、これは二値変数なので、条件式はとても単純です。</p>
<p>プログラムを実行し、<span class="imgref"><a href="./04-makeboard.html#recordmitame">図4.4</a></span>のようにチェックを付け外しして見た目が変わるか確認しましょう。</p>
<div id="recordmitame" class="image">
<img src="images/04-makeboard/recordmitame.png" alt="レコードの動作テスト" class="img border" />
<p class="caption">
図4.4: レコードの動作テスト
</p>
</div>
<p>これで、設定画面の入力内容の反映が全て終わりました！一度、実際のレースの結果を入力して動作を確認します。2022年の日本ダービー(勝ち馬:ドウデュース)を再現してみます。</p>
<div id="minitest" class="image">
<img src="images/04-makeboard/minitest.png" alt="現時点での完成図" class="img border" />
<p class="caption">
図4.5: 現時点での完成図
</p>
</div>

<h2 id="makecanvas" class="leftline"><a id="h4-3"></a><span class="secno">4.3</span> 図形を作成する</h2>
<p>掲示板の機能はほとんど完成しましたが、まだ見た目が異なる部分が存在します。着順のローマ数字の背景が四角になっていますね。ということで、図形の描画を使って背景を丸に変更します。</p>
<div id="canvas" class="caption-code">
<span class="caption">リスト4.11: リスト4.11: canvasの宣言</span>
<pre class="list">#掲示板を作り変える関数
def createwindow():
    global board
    if (board == None or not board.winfo_exists()):
    <span class="indentbar"> </span>   board = tk.Toplevel()
    <span class="indentbar"> </span>   board.geometry('500x850')
    <span class="indentbar"> </span>   board.resizable(False, False)
    <span class="indentbar"> </span>   board.title('掲示板')
    <span class="indentbar"> </span>   board.configure(bg='black')
    
    <b>canvas = tk.Canvas(board, bg='black', height=850, width=510 )</b>
</pre>
</div>
<p>図形の描画には<code class="inline-code">canvas</code>を使用します。ここまでのウィジェットは全てウィンドウに配置していましたが、図形はキャンバスを作り、その上に配置していきます。</p>
<p>キャンバスを作成出来たら、円を作成していきましょう。</p>
<div id="placecircle" class="caption-code">
<span class="caption">リスト4.12: リスト4.12: 円の配置</span>
<pre class="list">    tf_sec10_b = tk.Label(board, text=tf_sec10.get(), font=font(45), width=1, foreground='yellow', bg='#707070')

    #着順の後ろに表示する円
    <b>canvas.create_oval(10, 120, 90, 200, fill='blue')</b>
    <b>canvas.create_oval(10, 210, 90, 290, fill='blue')</b>
    <b>canvas.create_oval(10, 300, 90, 380, fill='blue')</b>
    <b>canvas.create_oval(10, 390, 90, 470, fill='blue')</b>
    <b>canvas.create_oval(10, 480, 90, 560, fill='blue')</b>

    #円を配置
    <b>canvas.pack()</b>
</pre>
</div>
<p>円の作成には、<code class="inline-code">create_oval()</code>を使用します。名前の通り、円だけでなく楕円も作成することができます。最初の二つの引数は始点のx座標とy座標、三つ目と四つ目の引数は対角点のx座標とy座標に対応しています。<code class="inline-code">fill</code>で円の色を指定しています。指定の方法についてはこれまでと同様です。</p>
<p>プログラムを実行してみましょう。<span class="imgref"><a href="./04-makeboard.html#circle">図4.6</a></span>のようになっていれば成功です。</p>
<div id="circle" class="image">
<img src="images/04-makeboard/circle.png" alt="円の作成" class="img border" />
<p class="caption">
図4.6: 円の作成
</p>
</div>

<h2 id="doutyaku" class="leftline"><a id="h4-4"></a><span class="secno">4.4</span> 同着の処理を作る</h2>
<p>これで完成・・・と言いたいところですが、実は忘れている機能があります。実は、同着が発生した場合、着順のローマ数字が変化するようになっています。</p>
<p>ということで、その処理を作成していきましょう。</p>
<div id="makedotyaku" class="caption-code">
<span class="caption">リスト4.13: リスト4.13: 同着処理の追加</span>
<pre class="list">    tf_sec10_b.place(x=452, y=770, height=55)

    <b>same = 0 #判定用の変数</b>
    #同着処理
    <b>if margin_12.get() == '同着': #1着同着の場合</b>
    <b>    second_b.configure(text='Ⅰ')</b>
    <b>    same = 1</b>

    <b>if margin_23.get() == '同着': #2着同着の場合</b>
    <b>    if same == 1:</b>
    <b>        third_b.configure(text='Ⅰ') #1~3着同着の場合</b>
    <b>    else:</b>
    <b>        third_b.configure(text='Ⅱ')</b>
    <b>        same = 2</b>
    <b>else:</b>
    <span class="indentbar"> </span>   <b>same = 3</b>

    <b>if margin_34.get() == '同着': #3着同着の場合</b>
    <b>    if same == 1:</b>
    <b>        fourth_b.configure(text='Ⅰ') #1~4着同着の場合</b>
    <b>    elif same == 2:</b>
    <b>        fourth_b.configure(text='Ⅱ') #2~4着同着の場合</b>
    <b>    else:</b>
    <b>        fourth_b.configure(text='Ⅲ')</b>
    <b>        same = 3</b>
    <b>else:</b>
    <span class="indentbar"> </span>   <b>same = 4</b>

    <b>if margin_45.get() == '同着': #4着同着の場合</b>
    <b>    if same == 1:</b>
    <b>        fifth_b.configure(text='Ⅰ') #1~5着同着の場合</b>
    <b>    elif same == 2:</b>
    <b>        fifth_b.configure(text='Ⅱ') #2~5着同着の場合</b>
    <b>    elif same == 3:</b>
    <b>        fifth_b.configure(text='Ⅲ') #3~5着同着の場合</b>
    <b>    else:</b>
    <b>        fifth_b.configure(text='Ⅳ')</b>
</pre>
</div>
<p>着差に<strong>同着</strong>と書かれたときに、条件式が働きます。ボックスの文字の取得とその判定を何度も行わないために、判定用の変数を導入しています。若干コードは長くなりますが、何度も同着と書くよりは楽だと思います。</p>
<p>ここで、新しい関数<code class="inline-code">configure</code>が登場しています。これは、ウィジェットに対して操作を行う関数です。ここではラベルのテキストの内容を変更するために使用しています。</p>
<p>プログラムを実行し、好きな着差の欄に<strong>同着</strong>と書き込んでみましょう。書き込んでみた例を<span class="imgref"><a href="./04-makeboard.html#doutyaku">図4.7</a></span>に示します。パターンが多すぎるので一つの例しか紹介できませんが、どのパターンでも正常に動作するはずです。</p>
<div id="doutyaku" class="image">
<img src="images/04-makeboard/doutyaku.png" alt="同着判定の動作の様子" class="img border" />
<p class="caption">
図4.7: 同着判定の動作の様子
</p>
</div>

        </main>
        <nav class="page-navi">
          <a href="03-configwindow.html" class="page-prev">&#9664;</a>
          <a href="99-postface.html" class="page-next">&#9654;</a>
        </nav>
        <footer>
        </footer>
      </div>
    </div>
    <script>
function rebuildAndReloadForcedly() {
  fetch('/rebuild.js').then((resp)=>{
    resp.text().then((text)=>{ eval(text); });
  });
}
    </script>
    <script src="/rebuild.js?file=04-makeboard.re"></script>
  </body>
</html>
<!-- layout.html5.erb -->
